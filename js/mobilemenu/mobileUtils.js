/* © 2012 Williams-Sonoma Inc. All rights reserved. */
dojo.provide("mobileUtils");if(!dojo._hasResource["wsgc.js.mobile.SlideoutShelf"]){dojo._hasResource["wsgc.js.mobile.SlideoutShelf"]=true;dojo.provide("wsgc.js.mobile.SlideoutShelf");dojo.declare("wsgc.js.mobile.SlideoutShelf",null,{constructor:function(_1,_2){var _3=function(_4){document.body.className=document.body.className.replace(" show-"+_2,"");};document.getElementById("shop-side-closer").addEventListener("click",_3);_1.addEventListener("click",function(_5){_5.stopPropagation();document.body.className+=" show-"+_2;});}});}if(!dojo._hasResource["dojo.NodeList-traverse"]){dojo._hasResource["dojo.NodeList-traverse"]=true;dojo.provide("dojo.NodeList-traverse");dojo.extend(dojo.NodeList,{_buildArrayFromCallback:function(_6){var _7=[];for(var i=0;i<this.length;i++){var _8=_6.call(this[i],this[i],_7);if(_8){_7=_7.concat(_8);}}return _7;},_filterQueryResult:function(_9,_a){var _b=dojo.filter(_9,function(_c){return dojo.query(_a,_c.parentNode).indexOf(_c)!=-1;});var _d=this._wrap(_b);return _d;},_getUniqueAsNodeList:function(_e){var _f=[];for(var i=0,_10;_10=_e[i];i++){if(_10.nodeType==1&&dojo.indexOf(_f,_10)==-1){_f.push(_10);}}return this._wrap(_f,null,this._NodeListCtor);},_getUniqueNodeListWithParent:function(_11,_12){var ary=this._getUniqueAsNodeList(_11);ary=(_12?this._filterQueryResult(ary,_12):ary);return ary._stash(this);},_getRelatedUniqueNodes:function(_13,_14){return this._getUniqueNodeListWithParent(this._buildArrayFromCallback(_14),_13);},children:function(_15){return this._getRelatedUniqueNodes(_15,function(_16,ary){return dojo._toArray(_16.childNodes);});},closest:function(_17){var _18=this;return this._getRelatedUniqueNodes(_17,function(_19,ary){do{if(_18._filterQueryResult([_19],_17).length){return _19;}}while((_19=_19.parentNode)&&_19.nodeType==1);return null;});},parent:function(_1a){return this._getRelatedUniqueNodes(_1a,function(_1b,ary){return _1b.parentNode;});},parents:function(_1c){return this._getRelatedUniqueNodes(_1c,function(_1d,ary){var _1e=[];while(_1d.parentNode){_1d=_1d.parentNode;_1e.push(_1d);}return _1e;});},siblings:function(_1f){return this._getRelatedUniqueNodes(_1f,function(_20,ary){var _21=[];var _22=(_20.parentNode&&_20.parentNode.childNodes);for(var i=0;i<_22.length;i++){if(_22[i]!=_20){_21.push(_22[i]);}}return _21;});},next:function(_23){return this._getRelatedUniqueNodes(_23,function(_24,ary){var _25=_24.nextSibling;while(_25&&_25.nodeType!=1){_25=_25.nextSibling;}return _25;});},nextAll:function(_26){return this._getRelatedUniqueNodes(_26,function(_27,ary){var _28=[];var _29=_27;while((_29=_29.nextSibling)){if(_29.nodeType==1){_28.push(_29);}}return _28;});},prev:function(_2a){return this._getRelatedUniqueNodes(_2a,function(_2b,ary){var _2c=_2b.previousSibling;while(_2c&&_2c.nodeType!=1){_2c=_2c.previousSibling;}return _2c;});},prevAll:function(_2d){return this._getRelatedUniqueNodes(_2d,function(_2e,ary){var _2f=[];var _30=_2e;while((_30=_30.previousSibling)){if(_30.nodeType==1){_2f.push(_30);}}return _2f;});},andSelf:function(){return this.concat(this._parent);},first:function(){return this._wrap(((this[0]&&[this[0]])||[]),this);},last:function(){return this._wrap((this.length?[this[this.length-1]]:[]),this);},even:function(){return this.filter(function(_31,i){return i%2!=0;});},odd:function(){return this.filter(function(_32,i){return i%2==0;});}});}if(!dojo._hasResource["wsgc.js.mobile.CollapsingList"]){dojo._hasResource["wsgc.js.mobile.CollapsingList"]=true;dojo.provide("wsgc.js.mobile.CollapsingList");dojo.declare("wsgc.js.mobile.CollapsingList",null,{constructor:function(_33){dojo.query(_33).connect("click",function(evt){var _34=evt.target.parentNode,_35=false,_36=function(evt){dojo.style(_33,"overflow","scroll");_33.removeEventListener("webkitTransitionEnd",_36);};if(evt.target.hasAttribute("href")){return;}if(dojo.hasClass(_34,"below-current")){var me=dojo.query(_34),_37=me.parent().parent(),_38=me.query("> ul > li"),_39=me.siblings();_37.removeClass("current").addClass("above-current");me.removeClass("below-current").addClass("current");_39.removeClass("below-current").addClass("hidden");_38.addClass("below-current");}if(dojo.hasClass(_34,"above-current")){var me=dojo.query(_34),_38=me.query("> ul > li"),_3a=me.query(".hidden, .below-current, .current, .above-current");me.removeClass("above-current").addClass("current");_3a.removeClass("hidden below-current current above-current");_38.addClass("below-current");}if(dojo.hasClass(_34,"top")){dojo.query(".browse-all",_33).removeClass("hidden");}if(dojo.hasClass(_34,"browse-all")){dojo.query(".hidden, .below-current, .current, .above-current",_33).removeClass("hidden below-current current above-current");dojo.query(".top",_33).addClass("below-current");dojo.query(".browse-all",_33).addClass("hidden");}});}});}if(!dojo._hasResource["wsgc.js.mobile.HeroSlider"]){dojo._hasResource["wsgc.js.mobile.HeroSlider"]=true;dojo.provide("wsgc.js.mobile.HeroSlider");dojo.declare("wsgc.js.mobile.HeroSlider",null,{constructor:function(_3b,_3c){_3c=_3c||"";function _3d(){var _3e=this;element=dojo.query(_3b);_3c=dojo.query(_3c);var _3f=element.query(">ul");var _40=element.query(">ul>li");var _41=0;var _42=_40.length;var _43=0;this.init=function(){_44();window.addEventListener("load",_44);window.addEventListener("resize",_44);window.addEventListener("orientationchange",_44);};function _44(){_41=element.position()[0].w;_40.forEach(function(ele,i){dojo.query(ele).style("width",_41+"px");});_3f.style("width",_41*_42+"px");};function _45(_46){_3c.query("li").removeClass("active").at(_46).addClass("active");};this.showPane=function(_47){_47=Math.max(0,Math.min(_47,_42-1));_43=_47;var _48=-((100/_42)*_43);_49(_48,true);_45(_43);};function _49(_4a,_4b){_3f.removeClass("animate");if(_4b){_3f.addClass("animate");}_3f.style("-webkit-transform","translate3d("+_4a+"%,0,0) scale3d(1,1,1)");};this.next=function(){return this.showPane(_43+1,true);};this.prev=function(){return this.showPane(_43-1,true);};function _4c(ev){ev.gesture.preventDefault();switch(ev.type){case "dragright":case "dragleft":var _4d=-(100/_42)*_43;var _4e=((100/_41)*ev.gesture.deltaX)/_42;if((_43==0&&ev.gesture.direction==Hammer.DIRECTION_RIGHT)||(_43==_42-1&&ev.gesture.direction==Hammer.DIRECTION_LEFT)){_4e*=0.4;}_49(_4e+_4d);break;case "swipeleft":_3e.next();ev.gesture.stopDetect();break;case "swiperight":_3e.prev();ev.gesture.stopDetect();break;case "release":if(Math.abs(ev.gesture.deltaX)>_41/2){if(ev.gesture.direction=="right"){_3e.prev();}else{_3e.next();}}else{_3e.showPane(_43,true);}break;}};Hammer(element[0]).on("release dragleft dragright swipeleft swiperight",_4c);};var _4f=new _3d();_4f.init();}});}if(!dojo._hasResource["wsgc.js.mobile.QuantityInput"]){dojo._hasResource["wsgc.js.mobile.QuantityInput"]=true;dojo.provide("wsgc.js.mobile.QuantityInput");dojo.declare("wsgc.js.mobile.QuantityInput",null,{constructor:function(_50){dojo.query(_50).connect("click",function(evt){evt.preventDefault();var _51=evt.target;if(dojo.hasClass(_51,"increase-count")){var _52=dojo.byId(dojo.attr(_51,"data-for")),_53=(parseInt(_52.value)||0)+1;_52.value=_53<=parseInt(_52.max)?_53:parseInt(_52.max);}else{if(dojo.hasClass(_51,"decrease-count")){var _52=dojo.byId(dojo.attr(_51,"data-for")),_53=(parseInt(_52.value)||0)-1;_52.value=_53>=parseInt(_52.min)?_53:parseInt(_52.min);}}return false;});_50.addEventListener("blur",function(evt){var _54=evt.target;if(dojo.hasClass(_54,"quantity-input")){_54.value=_54.value>parseInt(_54.max)?_54.max:_54.value;_54.value=_54.value<parseInt(_54.min)?_54.min:_54.value;}},true);}});}if(!dojo._hasResource["wsgc.js.mobile.BloomreachHelper"]){dojo._hasResource["wsgc.js.mobile.BloomreachHelper"]=true;dojo.provide("wsgc.js.mobile.BloomreachHelper");WSI.BloomreachHelper=WSI.BloomreachHelper||{};if(typeof BR!=="undefined"){(function(_55,BR,_56){"use strict";history.replaceState({"browseTo":window.location.href});window.addEventListener("popstate",function(_57){if(_57.state&&_57.state.browseTo){if(_57.state.browseTo!==window.location.href){window.location.href=_57.state.browseTo;}else{window.location.reload();}}});$(document).ready(function(){if($(".product-add-favorite").length||$(".product-get-related").length){_58();_59();}_5a();_5b();});var _5c={"accountId":4068,"authKey":"","domainKey":"potterybarn_com","environment":"prod","fieldNames":["title","url","thumb_image","price","sale_price","price_range","sale_price_range","sale_price_type","pid"]},_5d={};BR.$(".wrap").on("click",".br-next-page",function(evt){evt.preventDefault();BR.$(".wrap").brm_search("getNextPage",_5e);});BR.$(".wrap").on("click",".br-prev-page",function(evt){evt.preventDefault();var _5f=BR.$(this).data("start"),_60=BR.$(this).data("searchterm"),mlt=BR.$(this).data("mlt"),_61={"start":(_5f>0)?_5f:0};if(mlt){_61.pid=mlt;_61.request_type="mlt";}else{if(_60==="trending"){_61.search_type="trending";_61.l="trending";_61.request_type="search";}else{_61.search_type="keyword";_61.q=_60;_61.request_type="search";}}BR.$(".wrap").brm_search("search",_61);});var _62=function(_63,_64){_64=$.extend({},_64);_64.acct_id="4068";_64.ptype="search";_64.search_term=_63;try{if(BrTrk){var _65=BrTrk.getTracker(0.2,_64);_65.updateBrData(_64);_65.logPageView();}}catch(err){}};var _5e=function(_66){var _67,_68;$(".wrap").html(WSI.templates.bloomreachResultsDisplay(_66));if(_66.resultType==="mlt"){_67="/m/shop/"+_66.mltProduct.pid+"/related.html";_68="?cm_src=BR_SIMILARITEMS";_69({page:"similar"});}else{if(_66.resultType==="search"){if(_66.breadcrumbs[0].name==="trending"){_67="m/shop/popular.html";_68="?cm_src=BR_WHATSHOT";}else{_67="m/search/result03d2.html?q="+encodeURIComponent(_66.breadcrumbs[0].name);_68="?cm_src=BR_PRODUCTSEARCH";_69({page:"search",searchTerm:_66.breadcrumbs[0].name,numResults:_66.numResults});}}}if(_67!==""&&_67!==window.location.pathname){history.pushState({"browseTo":_67},"",_67);}$(".shop-list a").each(function(ind,ele){ele.href+=_68;});_58();_59();_5b();_62(_66.breadcrumbs[0].name,_66.brTrkData);};var _69=function(_6a){var _6b,_6c,_6d;switch(_6a.page){case "search":_6c="MOBILE "+(_6a.numResults?"PRODUCT":"NULL")+" SEARCH RESULTS";_6d="M:"+(_6a.numResults?"PRODUCT":"NULL")+"SEARCH";_6b={pi:_6c,vn2:"mobile",cg:_6d,se:_6a.searchTerm,sr:_6a.numResults};break;case "similar":_6b={pi:"MOBILE: BLOOMMOBILE SIMILAR ITEMS",vn2:"mobile",cg:"M:E:BR_SIMILARITEMS"};break;case "favorite":_6b={pi:"MOBILE: BLOOMMOBILE FAVORITES",vn2:"mobile",cg:"M:E:BR_FAVORITES"};break;}WSI.dynamicPageViewWriter.writePageView(_6b);};var _6e=function(_6f){$(".favorites-count").remove();if(_6f.items.length){$(".account-landing-icon .icon").after("<span class=\"favorites-count dp-icon-heart counter\">"+_6f.items.length+"</span>");}};_55.Search=function(_70){BR.$(_70).brm_search(BR.$.extend(_5c,{"numResults":24,"renderFunction":_5e}));};_55.MoreLikeThis=function(_71){BR.$(_71).brm_mlt({"numResults":24,"environment":"prod","request_type":"mlt","renderFunction":_5e,"searchConfig":_5c});BR.$(_71).on("click",".product-get-related",function(evt){evt.preventDefault();if(window.localStorage.hasSeenMoreLikeThisTutorial===undefined){window.localStorage.hasSeenMoreLikeThisTutorial="1";}var _72=BR.$(".wrap"),_73=BR.$(this).closest(".product").attr("data-group");BR.$(this).closest(".wrap").brm_mlt("getMlt",{pid:_73});_72.html(WSI.templates.loadingDisplay());});};_55.Autosuggest=function(_74){BR.$(_74).brm_suggest(BR.$.extend(_5c,{"searchButton":"#bloomreach-search .search-button","resultContainer":"#bloomreach-inline-search-results","maxSuggestResults":5,"searchCallback":function(_75,_76){var _77=BR.$(".wrap"),_78=BR.mobile.getHashUrlParams(_75);_77.brm_search("search",_78);_77.html(WSI.templates.loadingDisplay());},"onFocusCallback":function(){setTimeout(function(){window.scrollTo(0,0);},200);}}));};_55.Trending=function(){BR.$(".wrap").brm_search("search",{"request_type":"search","search_type":"trending","l":"trending"});};_55.JustForYou=function(_79){BR.pers.getJustForYou(_5c,function(_7a){$(".wrap").html(WSI.templates.bloomreachJustForYouDisplay(_7a));$(".shop-list .product a").each(function(ind,ele){$(ele).attr("href",$(ele).attr("href")+"?cm_src=BR_RECS");});_58();_59();_5a();});};var _7b=function(_7c){var _7d=$(_7c),pid=_7d.attr("data-group"),_7e=_7d.find(".product-name").text(),_7f=_7d.find(".thumb-wrapper img").attr("src"),url=_7d.find("a").attr("href"),_80=_7d.find(".our-price"),_81;if(_80.find(".price-range").length){_81=_80.find(".price-range").text().replace(/\$/g,"").split(" – ");}else{_81=_80.text().replace(/\$/g,"");}return {"pid":pid,"title":_7e,"thumb_image":_7f,"url":url,"price":_81};};var _58=function(){if(window.localStorage.hasSeenAddToFavoritesTutorial===undefined){window.localStorage.hasSeenAddToFavoritesTutorial="1";var _82=$("<div>",{"id":"favorites-tutorial"}),_83=$(".product-add-favorite").eq(1).closest(".action-icons");_82.insertAfter(_83);document.body.addEventListener("touchend",function(){BR.$("#favorites-tutorial").remove();});}else{if(BR.$("#favorites-tutorial").length){BR.$("#favorites-tutorial").remove();}}};var _59=function(){if(window.localStorage.hasSeenMoreLikeThisTutorial===undefined){window.localStorage.hasSeenMoreLikeThisTutorial="1";var _84=$("<div>",{"id":"more-like-this-tutorial"}),_85=$(".product-get-related").eq(0).closest(".action-icons");_84.insertAfter(_85);document.body.addEventListener("touchend",function(){BR.$("#more-like-this-tutorial").remove();});}else{if(BR.$("#more-like-this-tutorial").length){BR.$("#more-like-this-tutorial").remove();}}};var _5a=function(){BR.pers.getCurrentFavoriteList(_5c,function(_86,_87,_88){WSI.BloomreachHelper.cachedFavoritesList=_86;if(WSI.BloomreachHelper.cachedFavoritesList.items.length>0){$(".product-add-favorite").each(function(idx){var _89=BR.$(this).closest(".product"),_8a=_7b(_89),_8b=WSI.BloomreachHelper.cachedFavoritesList.containsItem(_8a.pid);if(_8b){$(this).addClass("favorite-added");}});_6e(_86);}});};var _5b=function(){if(BR.$("#bloomreach-search input").val()!==""){BR.$("#bloomreach-search input").val("");}};_55.FavoriteButtons=function(_8c){BR.$(_8c).on("click",".product-add-favorite",function(evt){evt.preventDefault();if(window.localStorage.hasSeenMoreLikeThisTutorial===undefined){window.localStorage.hasSeenMoreLikeThisTutorial="1";}BR.$("#favorites-tutorial").css("opacity",0);var _8d=BR.$(this).closest(".product"),_8e=_7b(_8d),_8f=this,_90=false;BR.pers.getCurrentFavoriteList(_5c,function(_91,_92,_93){WSI.BloomreachHelper.cachedFavoritesList=_91;_90=WSI.BloomreachHelper.cachedFavoritesList.containsItem(_8e.pid);if(_90){WSI.BloomreachHelper.cachedFavoritesList.removeItem(_8e.pid,function(_94,_95,_96){WSI.BloomreachHelper.cachedFavoritesList=_94;_6e(_94);$(_8f).removeClass("favorite-added");});}else{$(_8f).addClass("favorite-added");$("#fave-notification").show();setTimeout(function(){$("#fave-notification").hide();},1000);BR.pers.addFavorite(_5c,function(_97){_6e(_97);},_8e);WSI.BloomreachHelper.cachedFavoritesList.items.push(_8e);}});});};_55.FavoritesList=function(){BR.$(".shows-favorites-list").click(function(evt){BR.$(".wrap").html(WSI.templates.loadingDisplay());BR.pers.getCurrentFavoriteList(_5c,function(_98,_99,_9a){WSI.BloomreachHelper.cachedFavoritesList=_98;BR.$(".wrap").html(WSI.templates.bloomreachFavoritesList(_98));BR.$(".favorites-list .product .info").each(function(ind,ele){$(ele).append("<aside class=\"product-link\">View Details ></aside><div class=\"remove-favorite\"></div>");});BR.$(".favorites-list .product a").each(function(ind,ele){$(ele).attr("href",$(ele).attr("href")+"?cm_src=BR_FAVORITES");});BR.$(".favorites-list .remove-favorite").click(function(evt){evt.preventDefault();var _9b=BR.$(this).closest(".product").attr("data-group");BR.$(this).closest(".product").addClass("removed");WSI.BloomreachHelper.cachedFavoritesList.removeItem(_9b,function(_9c,_9d,_9e){WSI.BloomreachHelper.cachedFavoritesList=_9c;_6e(_9c);});});_69({page:"favorite"});});});};})(WSI.BloomreachHelper,BR,Handlebars);}}if(!dojo._hasResource["wsgc.common.js.PageViewWriter"]){dojo._hasResource["wsgc.common.js.PageViewWriter"]=true;dojo.provide("wsgc.common.js.PageViewWriter");(function(){var _9f,_a0,_a1=function(_a2){_9f=_a2.clientId;_a0=_a2.serverUrl;},_a3=function(_a4){var dt=new Date(),st=dt.getTime(),url=_a0+"/cm?ci="+_9f+"&vn1=4.1.1&ec=UTF-8&st="+st+"&ul="+encodeURIComponent(document.location.href)+"&rf="+encodeURIComponent(document.referrer)+"&tid=1"+_a5(_a4);return url;},_a5=function(_a6){var _a7,_a8="";for(_a7 in _a6){_a8=_a8+"&"+_a7+"="+encodeURIComponent(_a6[_a7]);}return _a8;};_a1.prototype={constructor:_a1,writePageView:function(_a9){var url=_a3(_a9),img=document.createElement("img");img.src=url+"&rnd="+Math.floor(Math.random()*10000000000000);document.body.appendChild(img);}};wsgc.common.js.PageViewWriter=_a1;})();}
